!function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("appointment-picker",[],function(){return t(e)}):e.AppointmentPicker=t(e)}(this,function(e){"use strict";function t(e,t,i){for(var n in i)e.options[n]=i[n];if(e.el){if(void 0!==e.el.length)return void console.warn("appointment-picker: pass only one dom element as argument");if(e.options.interval>60)return void console.warn("appointment-picker: the maximal interval is 60");e.options.disabled.forEach(function(t,i){e.disabledArr[i]=s(e.options.disabled[i])});for(var r=0;r<60/e.options.interval;r++)e.intervals[r]=r*e.options.interval;e.options["static"]?(e.picker=e.build(),e.picker.classList.add("is-position-static"),e.picker.addEventListener("click",e.selectionEventFn),e.isInDom=!0):t.addEventListener("focus",e.openEventFn),e.setTime(e.el.value),t.addEventListener("keyup",e.keyEventFn),t.addEventListener("change",e.changeEventFn)}}function i(e,t,i,n,s){var r=!1;return e<i.minTime||e>i.maxTime||e>24?(console.log("hour out of min/max",e,i.minTime,"/",i.maxTime),!1):n.indexOf(t)<0?(console.log("minutes not matching interval",t),!1):(s.forEach(function(i,n){i.h===e&&i.m===t&&(r=!0)}),r?!1:!0)}function n(e){return/^[0-9]{1}$/.test(e)?"0"+e:e}function s(e){var t,i=e.match(/^([\d]{1,2}):([\d]{2})[\s]*([ap][m])?.*$/);return i?(t="pm"===i[3]&&"12"!==i[1]?Number(i[1])+12:"am"===i[3]&&"12"===i[1]?0:i[1],{h:Number(t),m:Number(i[2])}):void 0}function r(e,t,i,s){var r=e;return s&&(e>12?r=e-12:0==e&&(r=12),i=i.replace(12>e?"p":"a","")),i.replace("H",r).replace("M",n(t))}function o(e,t){if(!e)return null;var i=0>t?e.previousElementSibling:e.nextElementSibling;return i&&i.className.indexOf("disabled")<0?i:o(i,t)}function a(e,t,n,s){for(var o=e.startTime,a=e.endTime,l="",c="12h"===e.mode,p=c?t.time12:t.time24,h=o;a>h;h++)for(var d=0;d<n.length;d++){var m=n[d],u=!i(h,m,e,n,s),v=r(h,m,p,c);l+=t.inner.replace("{{time}}",v).replace(/{{disabled}}/gi,u?"disabled":"")}return t.outer.replace("{{classes}}",e.large?"is-large":"").replace("{{title}}",e.title).replace("{{innerHtml}}",l)}var l=function(e,i){this.options={interval:60,minTime:0,maxTime:24,startTime:0,endTime:24,disabled:[],mode:"24h",large:!1,"static":!1,title:"Pick a time"},this.template={inner:'<li class="appo-picker-list-item {{disabled}}"><input type="button" tabindex="-1" value="{{time}}" {{disabled}}></li>',outer:'<span class="appo-picker-title">{{title}}</span><ul class="appo-picker-list">{{innerHtml}}</ul>',time12:"H:M apm",time24:"H:M"},this.el=e,this.picker=null,this.isOpen=!1,this.isInDom=!1,this.time={},this.intervals=[],this.disabledArr=[],this.displayTime="",this.selectionEventFn=this.select.bind(this),this.changeEventFn=this.onchange.bind(this),this.closeEventFn=this.close.bind(this),this.openEventFn=this.open.bind(this),this.keyEventFn=this.onKeyPress.bind(this),this.tabKeyUpEventFn=this.onTabKeyUp.bind(this),t(this,e,i||{})};return l.prototype.render=function(){if(this.isOpen){var e=this.el.offsetTop+this.el.offsetHeight,t=this.el.offsetLeft,i=this.picker.querySelector("input.is-selected");if(this.picker.classList.add("is-open"),i&&i.classList.remove("is-selected"),this.time.hasOwnProperty("h")){var n=this.picker.querySelector('[value="'+this.displayTime+'"]');n&&n.classList.add("is-selected")}this.picker.style.top=e+"px",this.picker.style.left=t+"px"}else this.picker.classList.remove("is-open")},l.prototype.open=function(e){if(!this.isOpen){this.isInDom||(this.picker=this.build(),this.isInDom=!0),this.isOpen=!0,this.render(),this.picker.addEventListener("click",this.selectionEventFn),this.picker.addEventListener("keyup",this.keyEventFn);var t=this;setTimeout(function(){document.body.addEventListener("click",t.closeEventFn),document.body.addEventListener("focus",t.tabKeyUpEventFn,!0)},100)}},l.prototype.close=function(e){if(this.isOpen){if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),e)for(var t=e.target;t;){if(t.matches(".appo-picker"))return;t=t.parentElement}this.isOpen=!1,this.render(),this.picker.removeEventListener("click",this.selectionEventFn),this.picker.removeEventListener("keyup",this.keyEventFn),document.body.removeEventListener("click",this.closeEventFn),document.body.removeEventListener("focus",this.tabKeyUpEventFn,!0)}},l.prototype.select=function(e){var t=this;e.target.value&&(this.setTime(e.target.value),this.el.focus(),setTimeout(function(){t.close(null)},100))},l.prototype.onchange=function(e){this.setTime(this.el.value)},l.prototype.onKeyPress=function(e){var t=this.picker.querySelector('input[type="button"]:not([disabled])'),i=this.picker.querySelector("input.is-selected"),n=null;switch(e.keyCode){case 13:case 27:this.close(null);break;case 38:n=i?o(i.parentNode,-1):t.parentNode;break;case 40:n=i?o(i.parentNode,1):t.parentNode}n&&!n.firstChild.disabled&&(n.firstChild.classList.add("is-selected"),i&&i.classList.remove("is-selected"),this.setTime(n.firstChild.value))},l.prototype.onTabKeyUp=function(e){this.isOpen&&this.close(e)},l.prototype.build=function(){var e=document.createElement("div");return e.innerHTML=a(this.options,this.template,this.intervals,this.disabledArr),e.className="appo-picker"+(this.options.large?" is-large":""),e.setAttribute("aria-hidden",!0),this.el.insertAdjacentElement("afterend",e),e},l.prototype.destroy=function(){this.close(null),this.picker&&(this.picker.parentNode.removeChild(this.picker),this.picker=null),this.el.removeEventListener("focus",this.openEventFn),this.el.removeEventListener("keyup",this.keyEventFn),this.el.removeEventListener("change",this.changeEventFn)},l.prototype.setTime=function(e){var t=s(e),n="24h"===this.options.mode,o=n?this.template.time24:this.template.time12;if(t||e){if(t){var a=t.h,l=t.m,c=i(a,l,this.options,this.intervals,this.disabledArr);if(c){this.time=t,this.displayTime=r(this.time.h,this.time.m,o,!n);var p=document.createEvent("Event");p.initEvent("change.appo.picker",!0,!0),p.time=this.time,this.el.dispatchEvent(p)}}}else console.log("empty string"),this.time={},this.displayTime="";this.el.value=this.displayTime},l.prototype.getTime=function(){return this.time},l});